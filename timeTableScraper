#!/bin/bash

python3 -c "
from urllib.request import urlopen
from html.parser import HTMLParser
import re

# Extract data from Time Table
html = urlopen('http://www.artsandscience.utoronto.ca/ofr/timetable/winter/csc.html')
htmlData = html.read()

# The regular expressions for all 6 fields
course = re.compile('^CSC\d{3}')
section = re.compile('^[FS]{1}$')
lecture = re.compile('^[LT]\d{4}')
time = re.compile('^[MWTRF]{1,3}\d{1}|Cancel')
instructor = re.compile('^\w\.|Tba|Staff')
location = re.compile('^\w{2} \d{1,4}')



# Different cases for extracted data
class MyHTMLParser(HTMLParser):
    courseMemory = ''

    def handle_data(self, data):
    	if course.match(data):
	        print('<tr><td>', data, '</td>\n')
	        self.courseMemory = data
	        pass
    	if section.match(data):
	        print('<td>', data, '</td></tr>\n')
	        pass

    	if lecture.match(data):
	        print('<tr><td>&nbsp</td><td>&nbsp</td><td>Type: ', data, '</td>\n')
	        pass
    	if time.match(data):
	        print('<tr><td>',self.courseMemory,'</td><td>&nbsp</td><td>&nbsp</td><td>', data, '</td>\n')
	        pass
    	if location.match(data):
	        print('<td>', data, '</td>\n')
	        pass
    	if instructor.match(data):
	        print('<td>', data, '</td></tr>\n')
	        pass

parser = MyHTMLParser(strict=False)

print('<table id=\"timeTable\">')
print('<tr>'
	+ '<td>Course</td>'
	+ '<td>Section</td>'
	+ '<td>Type</td>'
	+ '<td>Time</td>'
	+ '<td>Location</td>'
	+ '<td>Instructor</td>'
	+ '</tr><div><p>')
parser.feed(str(htmlData))
print('</p></div></table>')
" > res/timeTable.txt